#!/bin/sh

####################################################################################################
# esishell
#
#   A shell script that curls the a DP URL and retrieves the ESI script generated by DP to be 
#   passed back to Akamai. The "Accept-ESI" header is attached to this request to cause the 
#   AkamaiShellIntercepter.java code to execute.
#
####################################################################################################

if [ "$#" -ne 1 ]; then
    echo "Usage: $0 URL"
    echo "       $0 https://localhost:8466/promotion/leather-sunday-golf-shoe-bag/eligiblePromotions.json"
    exit 1
fi

verifyAkamaiCreds
if [ $? -ne 0 ]; then
    exit 1
fi

QA_USER_PASSWORD=`cat ~/.akamai-creds | base64 -D`

curl -k --user "${QA_USER_PASSWORD}" -H "Accept-ESI: 1.0" $1 | "$(dirname "${BASH_SOURCE[0]}")"/formatesi.pl
